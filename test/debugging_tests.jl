# REopt®, Copyright (c) Alliance for Sustainable Energy, LLC. See also https://github.com/NREL/REopt.jl/blob/master/LICENSE.
using HiGHS
using DelimitedFiles

@testset "AC and DC PVs" begin
    m1 = Model(optimizer_with_attributes(HiGHS.Optimizer))
    m2 = Model(optimizer_with_attributes(HiGHS.Optimizer))
    # m1 = Model(optimizer_with_attributes(Xpress.Optimizer, "OUTPUTLOG" => 0, "MAXIIS" => -1))
    # m2 = Model(optimizer_with_attributes(Xpress.Optimizer, "OUTPUTLOG" => 0, "MAXIIS" => -1))
    
    inputs = JSON.parsefile("./scenarios/ac_dc_pvs.json")
    inputs["ElectricTariff"]["tou_energy_rates_per_kwh"] = repeat(cat(0.2*ones(15), 0.4*ones(5), 0.2*ones(4), dims=1), outer=365)

    # results = run_reopt([m1,m2], inputs)
    results = run_reopt(m2, inputs)
    open("ac_dc_pvs_results.json","w") do f
        JSON.print(f, results, 4)
    end
    # for (key, model) in Dict("OPT" => m2)#"BAU" => m1, 
    #     println(key)
    #     # MOI.compute_conflict!(backend(model))
    #     compute_conflict!(model)
	# 	# if MOI.get(backend(model), MOI.ConflictStatus()) == MOI.CONFLICT_FOUND
    #     if get_attribute(model, MOI.ConflictStatus()) == MOI.CONFLICT_FOUND
    #         iis_model, _ = copy_conflict(model)
    #         print(iis_model)
    #         # println(keys(model.obj_dict))
    #         # open("ac_dc_pvs_conflicts.json","w") do f
    #         #     JSON.print(f, model.obj_dict, 4)
    #         # end
	# 		# for (name, obj) in model.obj_dict
    #         #     # println(typeof(obj))
	# 		# 	# if typeof(obj) <: ConstraintRef
    #         #     #     println(MOI.get(model, MOI.ConstraintConflictStatus(), obj))
	# 		# 	# 	if MOI.get(model, MOI.ConstraintConflictStatus(), obj) == MOI.IN_CONFLICT
	# 		# 	# 		println(obj)
	# 		# 	# 	end
    #         #     println(name)
	# 		# 	if typeof(obj) <: JuMP.Containers.DenseAxisArray || typeof(obj) <: JuMP.Containers.SparseAxisArray
	# 		# 		for elem in obj
	# 		# 			# if typeof(elem) <: ConstraintRef
    #         #             try
    #         #                 println(MOI.get(model, MOI.ConstraintConflictStatus(), elem))
	# 		# 				# if MOI.get(model, MOI.ConstraintConflictStatus(), elem) == MOI.IN_CONFLICT
	# 		# 				# 	println(elem)
	# 		# 				# end
    #         #             catch
    #         #                 # println(typeof(elem))
	# 		# 			end
	# 		# 		end
    #         #     else
    #         #         try
    #         #             # println(typeof(obj))
    #         #             println(MOI.get(model, MOI.ConstraintConflictStatus(), obj))
    #         #             # if MOI.get(model, MOI.ConstraintConflictStatus(), obj) == MOI.IN_CONFLICT
    #         #             #     println(obj)
    #         #             # end
    #         #         catch
    #         #             # println(typeof(obj))
    #         #         end
	# 		# 	end
	# 		# end
	# 	end
    # end

    @test results["ElectricStorage"]["size_kw"] ≈ 158.21 atol=0.1
    @test results["ElectricStorage"]["size_kwh"] ≈ 919.66 atol=0.1
    # @test results["ElectricStorage"]["dc_couple_inverter_size_kw"] ≈ 82.18 atol=0.1

    ground_pv = results["PV"][findfirst(pv -> pv["name"] == "ground", results["PV"])]
    roof_west = results["PV"][findfirst(pv -> pv["name"] == "roof_west", results["PV"])]
    roof_east = results["PV"][findfirst(pv -> pv["name"] == "roof_east", results["PV"])]

    @test ground_pv["size_kw"] ≈ 81.6667 atol=0.1
    @test roof_west["size_kw"] ≈ 30.0 atol=0.1
    @test roof_east["size_kw"] ≈ 472.6355 atol=0.1
    # @test ground_pv["lifecycle_om_cost_after_tax_bau"] ≈ 6256.0 atol=0.1
    # @test roof_west["lifecycle_om_cost_after_tax_bau"] ≈ 4692.0 atol=0.1
    # @test ground_pv["annual_energy_produced_kwh_bau"] ≈ 71463.73 atol=0.1
    # @test roof_west["annual_energy_produced_kwh_bau"] ≈ 45938.58 atol=0.1
    @test ground_pv["annual_energy_produced_kwh"] ≈ 145904.83 atol=1
    @test roof_west["annual_energy_produced_kwh"] ≈ 45938.58 atol=1
    @test roof_east["annual_energy_produced_kwh"] ≈ 789975.9 atol=1
    @test sum(ground_pv["electric_to_storage_series_kw"]) ≈ 50223.442 atol=1
    @test sum(roof_west["electric_to_storage_series_kw"]) ≈ 14514.219 atol=1
    @test sum(roof_east["electric_to_storage_series_kw"]) ≈ 228947.146 atol=1
    expected_outage_results = Dict(
        "expected_outage_cost" => 38003.69101517182,
        "electric_storage_microgrid_upgraded" => true,
        "unserved_load_per_outage_kwh" => [
            [
                2934.9
            ]
        ],
        "pv_microgrid_size_kw" => 121.6667,
        "pv_to_storage_series_kw" => [
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    2.467
                ]
            ],
            [
                [
                    7.593
                ]
            ],
            [
                [
                    27.479
                ]
            ],
            [
                [
                    14.63
                ]
            ],
            [
                [
                    21.782
                ]
            ],
            [
                [
                    4.668
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ]
        ],
        "critical_loads_per_outage_series_kw" => [
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    35.7032525087
                ]
            ],
            [
                [
                    39.13324098535
                ]
            ],
            [
                [
                    65.73176077400001
                ]
            ],
            [
                [
                    98.6273313215
                ]
            ],
            [
                [
                    98.5803765585
                ]
            ],
            [
                [
                    98.5217491685
                ]
            ],
            [
                [
                    98.5224687115
                ]
            ],
            [
                [
                    98.5364321545
                ]
            ],
            [
                [
                    98.536721342
                ]
            ],
            [
                [
                    98.3879792935
                ]
            ],
            [
                [
                    100.0259452265
                ]
            ],
            [
                [
                    108.680057484
                ]
            ],
            [
                [
                    84.6323553725
                ]
            ],
            [
                [
                    84.696616961
                ]
            ],
            [
                [
                    75.87522944749999
                ]
            ],
            [
                [
                    30.45418713595
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    16.06619674345
                ]
            ],
            [
                [
                    16.4401459875
                ]
            ],
            [
                [
                    16.42034179565
                ]
            ],
            [
                [
                    16.5319430043
                ]
            ],
            [
                [
                    35.5986135471
                ]
            ],
            [
                [
                    30.8088586586
                ]
            ],
            [
                [
                    47.996797263800005
                ]
            ],
            [
                [
                    74.0402767375
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    99.7876786385
                ]
            ],
            [
                [
                    108.353473262
                ]
            ],
            [
                [
                    75.3876981175
                ]
            ],
            [
                [
                    57.674028539999995
                ]
            ],
            [
                [
                    57.684197782999995
                ]
            ],
            [
                [
                    40.10646857055
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    16.0157476851
                ]
            ],
            [
                [
                    16.030614242
                ]
            ],
            [
                [
                    16.0572089538
                ]
            ],
            [
                [
                    5.697231791
                ]
            ],
            [
                [
                    30.045383660949998
                ]
            ],
            [
                [
                    29.6814054141
                ]
            ],
            [
                [
                    56.2519097805
                ]
            ],
            [
                [
                    56.2519097805
                ]
            ],
            [
                [
                    73.965579358
                ]
            ],
            [
                [
                    73.965579358
                ]
            ],
            [
                [
                    73.965579358
                ]
            ],
            [
                [
                    73.965579358
                ]
            ],
            [
                [
                    75.67873828249999
                ]
            ],
            [
                [
                    66.5308633285
                ]
            ],
            [
                [
                    48.817193751199994
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    35.793373751
                ]
            ],
            [
                [
                    39.14933736705
                ]
            ],
            [
                [
                    65.4495116485
                ]
            ],
            [
                [
                    98.08212518399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    98.07451971399999
                ]
            ],
            [
                [
                    99.7876786385
                ]
            ],
            [
                [
                    108.353473262
                ]
            ],
            [
                [
                    84.244532906
                ]
            ],
            [
                [
                    84.244532906
                ]
            ],
            [
                [
                    75.3876981175
                ]
            ],
            [
                [
                    30.45418713595
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ]
        ],
        "pv_microgrid_upgrade_cost" => 0.0,
        "max_outage_cost_per_outage_duration" => [
            38003.69101517182
        ],
        "unserved_load_series_kw" => [
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    35.7032525087
                ]
            ],
            [
                [
                    4.4985749249905425
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    38.954240578951485
                ]
            ],
            [
                [
                    25.215782278447378
                ]
            ],
            [
                [
                    18.46897149460871
                ]
            ],
            [
                [
                    18.526527228529417
                ]
            ],
            [
                [
                    38.47081039497125
                ]
            ],
            [
                [
                    57.809153953554144
                ]
            ],
            [
                [
                    56.7607599028973
                ]
            ],
            [
                [
                    94.84041781498684
                ]
            ],
            [
                [
                    108.680057484
                ]
            ],
            [
                [
                    84.6323553725
                ]
            ],
            [
                [
                    84.696616961
                ]
            ],
            [
                [
                    43.99892355189999
                ]
            ],
            [
                [
                    30.45418713595
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    16.06619674345
                ]
            ],
            [
                [
                    16.4401459875
                ]
            ],
            [
                [
                    16.42034179565
                ]
            ],
            [
                [
                    16.5319430043
                ]
            ],
            [
                [
                    35.5986135471
                ]
            ],
            [
                [
                    27.545618904499626
                ]
            ],
            [
                [
                    8.992402886784191
                ]
            ],
            [
                [
                    15.780079410714663
                ]
            ],
            [
                [
                    47.66268221460136
                ]
            ],
            [
                [
                    48.483197172743154
                ]
            ],
            [
                [
                    36.54749512535171
                ]
            ],
            [
                [
                    25.114796075762854
                ]
            ],
            [
                [
                    37.42444801644768
                ]
            ],
            [
                [
                    24.598784868702396
                ]
            ],
            [
                [
                    88.85549108487504
                ]
            ],
            [
                [
                    108.353473262
                ]
            ],
            [
                [
                    75.3876981175
                ]
            ],
            [
                [
                    57.674028539999995
                ]
            ],
            [
                [
                    57.684197782999995
                ]
            ],
            [
                [
                    40.10646857055
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    16.0157476851
                ]
            ],
            [
                [
                    16.030614242
                ]
            ],
            [
                [
                    16.0572089538
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    3.552713678800501e-15
                ]
            ],
            [
                [
                    3.552713678800501e-15
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    13.438481755355632
                ]
            ],
            [
                [
                    0.9567510014497458
                ]
            ],
            [
                [
                    64.50725185406851
                ]
            ],
            [
                [
                    66.5308633285
                ]
            ],
            [
                [
                    48.817193751199994
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    15.938152947799999
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    35.793373751
                ]
            ],
            [
                [
                    30.509936857109146
                ]
            ],
            [
                [
                    25.36579835636666
                ]
            ],
            [
                [
                    4.641551207752826
                ]
            ],
            [
                [
                    21.587254811716633
                ]
            ],
            [
                [
                    13.769712185780705
                ]
            ],
            [
                [
                    13.496360661803237
                ]
            ],
            [
                [
                    19.900055645888102
                ]
            ],
            [
                [
                    32.82177591806004
                ]
            ],
            [
                [
                    21.53986100962777
                ]
            ],
            [
                [
                    86.83480344212165
                ]
            ],
            [
                [
                    108.353473262
                ]
            ],
            [
                [
                    84.244532906
                ]
            ],
            [
                [
                    84.244532906
                ]
            ],
            [
                [
                    63.961301861046564
                ]
            ],
            [
                [
                    30.45418713595
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ],
            [
                [
                    16.553543950349997
                ]
            ]
        ],
        "soc_series_fraction" => [
            [
                [
                    1.0
                ]
            ],
            [
                [
                    1.0
                ]
            ],
            [
                [
                    1.0
                ]
            ],
            [
                [
                    1.0
                ]
            ],
            [
                [
                    0.84
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.707
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.547
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.387
                ]
            ],
            [
                [
                    0.398
                ]
            ],
            [
                [
                    0.432
                ]
            ],
            [
                [
                    0.556
                ]
            ],
            [
                [
                    0.622
                ]
            ],
            [
                [
                    0.721
                ]
            ],
            [
                [
                    0.742
                ]
            ],
            [
                [
                    0.737
                ]
            ],
            [
                [
                    0.737
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.577
                ]
            ],
            [
                [
                    0.417
                ]
            ],
            [
                [
                    0.417
                ]
            ],
            [
                [
                    0.417
                ]
            ],
            [
                [
                    0.417
                ]
            ],
            [
                [
                    0.417
                ]
            ],
            [
                [
                    0.417
                ]
            ],
            [
                [
                    0.257
                ]
            ],
            [
                [
                    0.257
                ]
            ],
            [
                [
                    0.257
                ]
            ],
            [
                [
                    0.257
                ]
            ],
            [
                [
                    0.257
                ]
            ],
            [
                [
                    0.2
                ]
            ],
            [
                [
                    0.2
                ]
            ],
            [
                [
                    0.2
                ]
            ],
            [
                [
                    0.2
                ]
            ],
            [
                [
                    0.2
                ]
            ],
            [
                [
                    0.2
                ]
            ],
            [
                [
                    0.2
                ]
            ]
        ],
        "pv_curtailed_series_kw" => [
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ]
        ],
        "storage_microgrid_upgrade_cost" => 0.0,
        "pv_to_load_series_kw" => [
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    2.758
                ]
            ],
            [
                [
                    39.255
                ]
            ],
            [
                [
                    59.673
                ]
            ],
            [
                [
                    73.365
                ]
            ],
            [
                [
                    80.053
                ]
            ],
            [
                [
                    79.996
                ]
            ],
            [
                [
                    60.066
                ]
            ],
            [
                [
                    40.728
                ]
            ],
            [
                [
                    41.627
                ]
            ],
            [
                [
                    5.186
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    3.263
                ]
            ],
            [
                [
                    39.004
                ]
            ],
            [
                [
                    58.26
                ]
            ],
            [
                [
                    50.412
                ]
            ],
            [
                [
                    49.591
                ]
            ],
            [
                [
                    61.527
                ]
            ],
            [
                [
                    72.96
                ]
            ],
            [
                [
                    60.65
                ]
            ],
            [
                [
                    41.599
                ]
            ],
            [
                [
                    10.932
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    5.697
                ]
            ],
            [
                [
                    30.045
                ]
            ],
            [
                [
                    29.681
                ]
            ],
            [
                [
                    56.252
                ]
            ],
            [
                [
                    56.252
                ]
            ],
            [
                [
                    73.966
                ]
            ],
            [
                [
                    73.101
                ]
            ],
            [
                [
                    60.527
                ]
            ],
            [
                [
                    41.133
                ]
            ],
            [
                [
                    11.171
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    8.639
                ]
            ],
            [
                [
                    40.084
                ]
            ],
            [
                [
                    61.564
                ]
            ],
            [
                [
                    76.487
                ]
            ],
            [
                [
                    84.305
                ]
            ],
            [
                [
                    84.578
                ]
            ],
            [
                [
                    78.174
                ]
            ],
            [
                [
                    65.253
                ]
            ],
            [
                [
                    44.658
                ]
            ],
            [
                [
                    12.953
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ]
        ],
        "storage_discharge_series_kw" => [
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    31.8763058956
                ]
            ],
            [
                [
                    26.477048520759453
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    31.8763058956
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    31.8763058956
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.8641905819693108
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    31.8763058956
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    31.8763058956
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    31.8763058956
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    11.42639625645343
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ],
            [
                [
                    0.0
                ]
            ]
        ],
        "microgrid_upgrade_capital_cost" => 0.0
    )
end